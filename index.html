<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>You've Been Invited to SEELE AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@400;700&family=Source+Serif+4:opsz,wght@8..60,600&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Apply custom fonts */
      body {
        font-family: 'Inter', sans-serif;
      }
      .font-serif-display {
        font-family: 'Source Serif 4', serif;
      }
      .font-cursive {
        font-family: 'Great Vibes', cursive;
      }
      /* Animated background curves for visual flair */
      .bg-curves {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }
      .curve {
        position: absolute;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.05);
        animation: rotate 40s linear infinite;
      }
      .curve-1 {
        width: 150vmax;
        height: 150vmax;
        top: -50vmax;
        right: -50vmax;
      }
      .curve-2 {
        width: 120vmax;
        height: 120vmax;
        bottom: -60vmax;
        left: -20vmax;
        animation-direction: reverse;
        animation-duration: 50s;
      }
      @keyframes rotate {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      /* "Copied!" feedback tooltip style */
      .copied-feedback {
        position: absolute;
        top: -35px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #059669; /* Emerald 600 */
        color: white;
        padding: 4px 10px;
        border-radius: 7px;
        font-size: 0.875rem;
        font-weight: 600;
        opacity: 0;
        transition: opacity 0.3s ease, top 0.3s ease;
        white-space: nowrap;
        pointer-events: none;
      }
      .copied-feedback.show {
        opacity: 1;
        top: -45px;
      }
    </style>
  </head>
  <body
    class="bg-black text-gray-200 flex items-center justify-center min-h-screen p-4 overflow-hidden"
  >
    <div class="bg-curves">
      <div class="curve curve-1"></div>
      <div class="curve curve-2"></div>
    </div>

    <main class="w-full">
      <div id="loading-state" class="text-center">
        <div class="flex justify-center items-center">
          <div
            class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-400"
          ></div>
        </div>
        <p class="mt-4 text-gray-400">Claiming your invitation...</p>
      </div>

      <div id="content-state" class="hidden">
        <div
          class="w-full max-w-5xl mx-auto flex flex-col lg:flex-row items-center justify-center gap-8 lg:gap-16 px-4"
        >
          <div class="w-full max-w-xs sm:max-w-sm shrink-0 flex flex-col gap-4 order-2 lg:order-1">
            <div
              class="bg-gray-900/50 backdrop-blur-sm p-3 rounded-2xl border border-white/10 shadow-2xl"
            >
              <div class="aspect-[3/4] rounded-lg overflow-hidden relative">
                <video
                  src="https://ik.imagekit.io/dwovit2u8/0_1080_N.mp4?updatedAt=1758822992574"
                  autoplay
                  loop
                  muted
                  playsinline
                  class="w-full h-full object-cover"
                ></video>
              </div>
            </div>
            <div class="flex justify-center items-center gap-6 mt-2">
              <a
                href="https://x.com/SEELE_AI1125"
                target="_blank"
                rel="noopener noreferrer"
                class="text-gray-400 hover:text-white transition-colors"
              >
                <svg
                  class="w-6 h-6"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                >
                  <path
                    d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"
                  ></path>
                </svg>
              </a>
              <a
                href="https://discord.gg/SbgbQFq2tb"
                target="_blank"
                rel="noopener noreferrer"
                class="text-gray-400 hover:text-white transition-colors"
              >
                <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                  <path d="M13.545 2.907a13.227 13.227 0 0 0-3.257-1.011.05.05 0 0 0-.052.025c-.141.25-.297.577-.406.833a12.19 12.19 0 0 0-3.658 0 8.258 8.258 0 0 0-.412-.833.051.051 0 0 0-.052-.025c-1.125.194-2.22.534-3.257 1.011a.041.041 0 0 0-.021.037c.3.35.575.718.825 1.11a13.442 13.442 0 0 0-1.542 6.079.053.053 0 0 0 .002.022.047.047 0 0 0 .046.037c.138.018.29.04.45.058a12.041 12.041 0 0 0 1.256.635.05.05 0 0 0 .061-.025c.093-.134.18-.28.262-.435a11.21 11.21 0 0 0 1.572.449.05.05 0 0 0 .048-.002c.488-.262 1.016-.566 1.504-.874a.05.05 0 0 0 .048.002c.488.308 1.016.612 1.504.874a.05.05 0 0 0 .048.002c.56.153 1.096.324 1.572.449.082.155.17.301.262.435a.05.05 0 0 0 .061.025 12.041 12.041 0 0 0 1.256-.635.047.047 0 0 0 .046-.037.052.052 0 0 0 .002-.022 13.442 13.442 0 0 0-1.542-6.079c.25-.392.525-.76.825-1.11a.041.041 0 0 0-.021-.037zM8 10.995a2.995 2.995 0 1 1 0-5.99 2.995 2.995 0 0 1 0 5.99z"/>
                </svg>
              </a>
            </div>
          </div>

          <div
            class="flex flex-col items-center lg:items-start text-center lg:text-left order-1 lg:order-2"
          >
            <h1
              class="font-serif-display text-4xl sm:text-5xl font-semibold text-white leading-tight"
            >
              You've been invited<br />to SEELE AI
            </h1>
            <p class="mt-8 text-gray-400">Invited by</p>
            <div class="mt-2 flex items-center gap-4">
              <img
                id="kol-photo"
                src=""
                alt="KOL Avatar"
                class="w-16 h-16 rounded-full object-cover border-2 border-white/30 shadow-md"
              />
              <strong
                id="kol-name"
                class="font-cursive text-5xl text-white tracking-wide"
              ></strong>
            </div>

            <div id="action-container" class="mt-10 w-full">
              <div id="initial-state">
                <button
                  id="claim-button"
                  class="w-full max-w-xs mx-auto lg:mx-0 flex items-center justify-center gap-3 bg-white/10 hover:bg-white/20 border border-white/20 backdrop-blur-md text-white font-bold text-lg px-8 py-3 rounded-lg shadow-lg transition-all duration-300 transform hover:scale-105"
                >
                  <span>Claim Invite</span>
                </button>
              </div>

              <div id="revealed-state" class="hidden">
                <p class="text-sm text-gray-400">
                  Your invite code (paste this on the website):
                </p>
                <div
                  class="mt-2 flex items-center justify-between bg-gray-900/80 border border-white/20 rounded-lg p-3 max-w-xs mx-auto lg:mx-0"
                >
                  <span
                    id="invite-code"
                    class="text-2xl font-mono font-bold text-white tracking-widest"
                  ></span>
                  <button id="copy-button" class="relative text-gray-400 hover:text-white">
                    <div class="copied-feedback">Copied!</div>
                    <svg
                      class="w-6 h-6"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                      ></path>
                    </svg>
                  </button>
                </div>
                <div class="mt-6 flex flex-col items-center lg:items-start gap-4">
                    <a id="continue-link" href="#" class="inline-flex items-center gap-2 text-green-500 hover:text-green-400 font-semibold transition-colors">
                        <span>Open SEELE AI Website</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                    </a>
                    <a href="#" class="text-sm text-gray-500 underline hover:text-gray-300 transition-colors">
                        How to use the Invite Code?
                    </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="error-state" class="hidden text-center max-w-md mx-auto">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-900/50 border border-red-500/30">
          <svg class="h-6 w-6 text-red-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
        </div>
        <h2 class="mt-4 text-xl font-bold text-red-400">Oops! Something went wrong.</h2>
        <p id="error-message" class="mt-2 text-red-300 bg-red-900/50 p-3 rounded-md border border-red-500/30"></p>
      </div>
    </main>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Element References ---
        const loadingState = document.getElementById('loading-state');
        const contentState = document.getElementById('content-state');
        const errorState = document.getElementById('error-state');
        const errorMessage = document.getElementById('error-message');
        const kolPhoto = document.getElementById('kol-photo');
        const kolName = document.getElementById('kol-name');
        const inviteCodeElem = document.getElementById('invite-code');
        const continueLink = document.getElementById('continue-link');
        
        // New elements for two-step interaction
        const claimButton = document.getElementById('claim-button');
        const initialState = document.getElementById('initial-state');
        const revealedState = document.getElementById('revealed-state');
        const copyButton = document.getElementById('copy-button');

        // --- Logic ---
        const getDeviceId = () => {
          let deviceId = localStorage.getItem('uniqueDeviceId');
          if (!deviceId) {
            deviceId = 'guest-' + crypto.randomUUID();
            localStorage.setItem('uniqueDeviceId', deviceId);
          }
          return deviceId;
        };

        const getKolCode = () => {
          const sourcesToSearch = [window.location.href];
          for (const source of sourcesToSearch) {
            if (!source) continue;
            try {
              const match = source.match(/[?&#]kol=([^&#]*)/);
              if (match && match[1]) {
                return decodeURIComponent(match[1]);
              }
            } catch (e) {
              console.warn(`Error while scanning source: ${source}`, e);
            }
          }
          return null;
        };
        
        // Reveal the invite code when the claim button is clicked
        claimButton.addEventListener('click', () => {
            initialState.classList.add('hidden');
            revealedState.classList.remove('hidden');
        });

        // Handle copying the invite code to clipboard
        const handleCopy = () => {
          const codeToCopy = inviteCodeElem.textContent;
          if (!codeToCopy) return;

          navigator.clipboard
            .writeText(codeToCopy)
            .then(() => {
              const feedback = copyButton.querySelector('.copied-feedback');
              feedback.classList.add('show');
              setTimeout(() => {
                feedback.classList.remove('show');
              }, 2000);
            })
            .catch((err) => {
              console.error('Failed to copy code: ', err);
              alert('Failed to copy code.');
            });
        };
        copyButton.addEventListener('click', handleCopy);

        // Main function to fetch and display the invite code.
        const processInvite = async () => {
          try {
            const kolCode = getKolCode();
            if (!kolCode) {
              throw new Error('Could not find the invite code. Please double-check the link you used.');
            }
            const deviceId = getDeviceId();
            const apiUrl = new URL(
              'https://script.google.com/macros/s/AKfycby42z--ewLYgCKlNVL4dzrfgZcvRo5JVnipZnHH-fGl3KrNe4XnOVszrHNKvIEy2aVt/exec'
            );
            apiUrl.searchParams.append('kol', kolCode);
            apiUrl.searchParams.append('deviceId', deviceId);

            const response = await fetch(apiUrl);
            const data = await response.json();

            if (!response.ok || data.error) {
              throw new Error(data.error || `API request failed (status: ${response.status})`);
            }
            
            // Populate data into the elements
            kolPhoto.src = data.kolPhotoUrl;
            kolName.textContent = data.kolName;
            inviteCodeElem.textContent = data.inviteCode;
            continueLink.href = data.adjustLink;
            
            // Show the main content
            loadingState.classList.add('hidden');
            contentState.classList.remove('hidden');
          } catch (error) {
            console.error('Error processing invite:', error);
            errorMessage.textContent = error.message;
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
          }
        };

        // Start the process
        processInvite();
      });
    </script>
  </body>
</html>
